(()=>{var e={317:(e,r,s)=>{const t=s(436);s(818).config(),"production"===process.env.ENVIRONMENT&&t.init({dsn:process.env.SENTRY_DSN,integrations:[t.rewriteFramesIntegration()]})},412:(e,r,s)=>{const t=s(37);s(818).config(),e.exports=async()=>{try{await t.connect(process.env.MONGOURL),console.log("MongoDB is Connected...")}catch(e){console.error(e.message)}}},930:(e,r,s)=>{const t=s(571),n=s(486),i=s(829),o=s(652),{successResponse:a,catchResponse:u,errorResponse:d}=s(640),c=s(446),p=s(825);e.exports={Register:async(e,r)=>{try{const s=c.object({email:c.string().trim().required(),username:c.string().trim().required(),password:c.string().trim().required()}),{error:o}=s.validate(e.body);if(o){const e=p.get(o,"details[0].message","An unknown error occurred");return d(r,e,400)}const u=e.body.email.trim(),l=e.body.username.trim(),m=e.body.password.trim(),g=await t.findOne({$or:[{username:l},{email:u}]}).lean();if(g){if(g.is_verified)return d(r,g.username===l?`${l} username already taken`:"Account already exists!",401);await t.deleteOne({email:g.email})}const y=await n.hash(m,14),f=i.sign({username:l,email:u},process.env.JWT_SECRET,{expiresIn:"1h"}),v=new t({email:u,username:l,password:y,is_verified:!0,token:f});return await v.save(),a(r,v,"User registered successfully")}catch(e){return u(r,"Error occured in register",e)}},Login:async(e,r)=>{try{const s=c.object({username:c.string().trim().required(),password:c.string().trim().required()}),{error:i}=s.validate(e.body);if(i){const e=p.get(i,"details[0].message","An unknown error occurred");return d(r,e,400)}const o=e.body.username.trim(),u=e.body.password.trim(),l=await t.findOne({username:o,is_verified:!0},"username email is_verified password token").lean();return l?await n.compare(u,l.password)?(delete l.password,a(r,l,"Login successfully")):d(r,"Invalid username or password",401):d(r,"Account not exists or not verified",404)}catch(e){return console.log(e),u(r,"Error occured in login",e)}},UserDataProvider:async(e,r)=>{try{const s=c.object({token:c.string().trim().required()}),{error:n}=s.validate(e.body);if(n){const e=p.get(n,"details[0].message","An unknown error occurred");return d(r,e,400)}const i=e.body.token.trim(),o=await t.findOne({token:i,is_verified:!0},"email username token").lean();return o?a(r,o,"User data found"):d(r,"Invalid token",498)}catch(e){return u(r,"Error occured in user data",e)}},userProfileInfo:async(e,r)=>{try{if(e.user){const s=e.user,t=s._id,n=await o.find({userId:t}),i={email:s.email,username:s.username,address:s.address,phone_number:s.phone_number,orderData:n};return a(r,i,"Profile retrieved successfully")}return d(r,"Invalid token",498)}catch(e){return u(r,"Error occured in profile",e)}},userUpdateProfile:async(e,r)=>{try{const s=c.object({username:c.string().trim().required(),address:c.string().trim().allow("").required(),phone_number:c.string().allow("").trim().required()}),{error:n}=s.validate(e.body);if(n){const e=p.get(n,"details[0].message","An unknown error occurred");return d(r,e,400)}const i=e.body.username.trim(),o=e.body.address.trim(),u=e.body.phone_number.trim(),l=await t.findOneAndUpdate({username:i},{address:o,phone_number:u}).lean(),m={email:l.email,address:l.address,username:l.username,phone_number:l.phone_number};return a(r,m,"Profile updated successfully")}catch(e){return u(r,"Error occurred in profile update",e)}}}},868:(e,r,s)=>{const t=s(291),n=s(74),i=s(652),o=s(37),{successResponse:a,catchResponse:u,errorResponse:d}=s(640);e.exports={AllRestaurentFinder:async(e,r)=>{try{const e=await t.find();return a(r,e,"All restaurant found successfully")}catch(e){return u(r,"Error occured to get all restaurant",e)}},RestaurantByIdFinder:async(e,r)=>{try{const{id:s}=e.params;if(!o.isValidObjectId(s))return d(r,"Invalid restaurant page",400);const i=await t.findById(s),u=await n.find({restaurentId:i._id});return a(r,{restaurant:i,products:u||[]},"Restaurant data found successfully")}catch(e){return u(r,"Error occured in get restaurant data",e)}},AddOrder:async(e,r)=>{try{const{orderItems:s,shippingAddress:t,price:n,shippingPrice:a,totalPrice:u}=e.body,d=new i({userId:new o.Types.ObjectId(e.user._id),orderItems:s,shippingAddress:t,price:n,shippingPrice:a,totalPrice:u});await d.save(),r.status(200).json({message:"Order added successfully"})}catch(e){console.log(e),r.status(500).json({error:e.message})}}}},239:(e,r,s)=>{const t=s(571);e.exports={userAuthenticate:async(e,r,s)=>{const n=e.headers.authorization;if(!n)return r.status(404).json({error:"Invalid token"});{const i=await t.findOne({token:n});if(!i)return r.status(404).json({error:"Invalid token"});e.user=i,s()}}}},652:(e,r,s)=>{const t=s(37),n=new t.Schema({userId:{type:t.Schema.Types.ObjectId,ref:"User",required:!0},orderItems:[{name:{type:String,required:!0},quantity:{type:Number,required:!0},price:{type:Number,required:!0},productId:{type:t.Schema.Types.ObjectId,ref:"RestaurantProduct",required:!0}}],shippingAddress:{type:String,required:!0},price:{type:Number,required:!0,default:0},shippingPrice:{type:Number,required:!0,default:0},totalPrice:{type:Number,required:!0,default:0},isDelivered:{type:Boolean,required:!0,default:!1},deliveredAt:{type:Date}},{timestamps:!0});t.pluralize(null),e.exports=t.model("Order",n)},74:(e,r,s)=>{const t=s(37),n=new t.Schema({restaurentId:{type:t.Schema.Types.ObjectId,ref:"Restaurent",required:!0},name:{type:String,required:!0,trim:!0},price:{type:Number,required:!0},image:{type:String,required:!0},category:{type:String,required:!0},description:{type:String,required:!0}},{timestamps:!0});t.pluralize(null),e.exports=t.model("RestaurentProduct",n)},291:(e,r,s)=>{const t=s(37),n=new t.Schema({name:{type:String,required:!0,trim:!0},address:{type:String,required:!0,trim:!0},image:{type:String,required:!0,trim:!0},famous:{type:String,required:!0,trim:!0},rating:{type:Number,default:0,validate:{validator:function(e){return e>=0&&e<=5},message:e=>`${e.value} is not a valid rating!`}},phone_number:{type:String,validate:{validator:function(e){return!e||/^[1-9][0-9]{9}$/.test(e)},message:e=>`${e.value} is not a valid phone number!`},required:!0}},{timestamps:!0});t.pluralize(null),e.exports=t.model("Restaurent",n)},571:(e,r,s)=>{const t=s(37),n=new t.Schema({email:{unique:!0,type:String,required:!0,trim:!0},username:{unique:!0,type:String,required:!0,trim:!0},password:{type:String,required:!0},address:String,phone_number:{type:String,validate:{validator:function(e){return!e||/^[1-9][0-9]{9}$/.test(e)},message:e=>`${e.value} is not a valid phone number!`}},is_verified:{type:Boolean,required:!0},token:{type:String,required:!0}},{timestamps:!0});t.pluralize(null),n.index({email:1,username:1},{unique:!0}),e.exports=t.model("Users",n)},753:(e,r,s)=>{const{Register:t,Login:n,UserDataProvider:i,userProfileInfo:o,userUpdateProfile:a}=s(930),{userAuthenticate:u}=s(239),d=s(252).Router(),c=s(268).urlencoded({extended:!1});d.post("/register",c,t),d.post("/login",c,n),d.post("/user",c,i),d.get("/profile",u,o),d.post("/update-profile",c,u,a),e.exports=d},837:(e,r,s)=>{const{AllRestaurentFinder:t,RestaurantByIdFinder:n,AddOrder:i}=s(868),o=s(252).Router(),a=s(268).urlencoded({extended:!1}),{userAuthenticate:u}=s(239);o.get("/restaurent/all",t),o.get("/restaurent/:id",n),o.post("/restaurent/add-order",a,u,i),e.exports=o},640:(e,r,s)=>{const t=s(436);e.exports={successResponse:(e,r,s)=>e.json({success:1,data:r,message:s}),errorResponse:(e,r,s)=>((e=>{"production"===process.env.ENVIRONMENT?t.captureMessage(e):console.log(e)})(r),e.json({success:0,message:r,status:s})),catchResponse:(e,r,s)=>(((e,r)=>{"production"===process.env.ENVIRONMENT?t.captureException(e,r):console.log(e)})(s,r),e.status(500).json({success:0,message:r,error:s,status:500}))}},436:e=>{"use strict";e.exports=require("@sentry/node")},486:e=>{"use strict";e.exports=require("bcrypt")},268:e=>{"use strict";e.exports=require("body-parser")},898:e=>{"use strict";e.exports=require("cookie-parser")},577:e=>{"use strict";e.exports=require("cors")},818:e=>{"use strict";e.exports=require("dotenv")},252:e=>{"use strict";e.exports=require("express")},446:e=>{"use strict";e.exports=require("joi")},829:e=>{"use strict";e.exports=require("jsonwebtoken")},825:e=>{"use strict";e.exports=require("lodash")},37:e=>{"use strict";e.exports=require("mongoose")},928:e=>{"use strict";e.exports=require("path")},330:e=>{"use strict";e.exports=JSON.parse('{"name":"backend","version":"1.0.2","description":"","main":"server.js","scripts":{"test":"cross-env NODE_ENV=test jest --testTimeout=5000","start":"nodemon server.js","build:dev":"webpack --config webpack.config.js --mode development","build:prod":"webpack --config webpack.config.js --mode production","dev":"node ./dist/main.js"},"keywords":[],"author":"","license":"ISC","dependencies":{"@sentry/node":"^8.9.2","bcrypt":"^5.1.1","body-parser":"^1.20.2","cookie-parser":"^1.4.6","cors":"^2.8.5","cross-env":"^7.0.3","dotenv":"^16.3.1","express":"^4.19.2","jest":"^29.7.0","joi":"^17.13.3","jsonwebtoken":"^9.0.2","lodash":"^4.17.21","mongoose":"^8.0.0","nodemon":"^3.1.0","supertest":"^6.3.4"},"devDependencies":{"@babel/core":"^7.23.9","babel-loader":"^9.1.3","webpack":"^5.90.3","webpack-cli":"^5.1.4","webpack-node-externals":"^3.0.0"}}')}},r={};function s(t){var n=r[t];if(void 0!==n)return n.exports;var i=r[t]={exports:{}};return e[t](i,i.exports,s),i.exports}(()=>{s(317);const e=s(252),r=e(),t=s(577),n=(s(818).config(),process.env.PORT||80),i=s(412),o=s(753),a=s(898),u=s(837),d=s(928),c=process.env.ENVIRONMENT,p=("production"===c&&process.env.FRONTEND_BASE_URL,s(436));s(330),i(),r.use(a({})),r.use(t()),r.use("/images/restaurant",e.static(d.join(__dirname,"production"===c?"../src/Images/restaurant":"./src/Images/restaurant"))),r.use("/images/product",e.static(d.join(__dirname,"production"===c?"../src/Images/product":"./src/Images/product"))),r.use(e.urlencoded({extended:!0})),r.use(e.json()),r.use("/api/auth",o),r.use("/api",u),"production"===process.env.ENVIRONMENT&&p.setupExpressErrorHandler(r),r.listen(n,(()=>{console.log(`Server is running on port ${n}`)}))})()})();