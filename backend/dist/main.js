(()=>{var e={317:(e,r,t)=>{const s=t(436);s.init({dsn:"https://d773c731df0df3356dffd58d1cb6612e@o4507123081412608.ingest.de.sentry.io/4507441037770832",integrations:[s.rewriteFramesIntegration()]})},412:(e,r,t)=>{const s=t(37);t(818).config(),e.exports=async()=>{try{await s.connect(process.env.MONGOURL),console.log("MongoDB is Connected...")}catch(e){console.error(e.message)}}},930:(e,r,t)=>{const s=t(571),n=t(486),i=t(829),o=t(652),{successResponse:a,catchResponse:u,errorResponse:d}=t(640),c=t(446),p=t(825);e.exports={Register:async(e,r)=>{try{const t=c.object({email:c.string().trim().required(),username:c.string().trim().required(),password:c.string().trim().required()}),{error:o}=t.validate(e.body);if(o){const e=p.get(o,"details[0].message","An unknown error occurred");return d(r,e,400)}const u=e.body.email.trim(),l=e.body.username.trim(),m=e.body.password.trim(),g=await s.findOne({$or:[{username:l},{email:u}]}).lean();if(g){if(g.is_verified)return d(r,g.username===l?`${l} username already taken`:"Account already exists!",401);await s.deleteOne({email:g.email})}const y=await n.hash(m,14),f=i.sign({username:l,email:u},process.env.JWT_SECRET,{expiresIn:"1h"}),b=new s({email:u,username:l,password:y,is_verified:!0,token:f});return await b.save(),a(r,b,"User registered successfully")}catch(e){return u(r,"Error occured in register",e)}},Login:async(e,r)=>{try{const t=c.object({username:c.string().trim().required(),password:c.string().trim().required()}),{error:i}=t.validate(e.body);if(i){const e=p.get(i,"details[0].message","An unknown error occurred");return d(r,e,400)}const o=e.body.username.trim(),u=e.body.password.trim(),l=await s.findOne({username:o,is_verified:!0},"username email is_verified password token").lean();return l?await n.compare(u,l.password)?(delete l.password,a(r,l,"Login successfully")):d(r,"Invalid username or password",401):d(r,"Account not exists or not verified",404)}catch(e){return console.log(e),u(r,"Error occured in login",e)}},UserDataProvider:async(e,r)=>{try{const t=c.object({token:c.string().trim().required()}),{error:n}=t.validate(e.body);if(n){const e=p.get(n,"details[0].message","An unknown error occurred");return d(r,e,400)}const i=e.body.token.trim(),o=await s.findOne({token:i,is_verified:!0},"email username token").lean();return o?a(r,o,"User data found"):d(r,"Invalid token",498)}catch(e){return u(r,"Error occured in user data",e)}},userProfileInfo:async(e,r)=>{try{if(e.user){const t=e.user,s=t._id,n=await o.find({userId:s}),i={email:t.email,username:t.username,address:t.address,phone_number:t.phone_number,orderData:n};return a(r,i,"Profile retrieved successfully")}return d(r,"Invalid token",498)}catch(e){return u(r,"Error occured in profile",e)}},userUpdateProfile:async(e,r)=>{try{const t=c.object({username:c.string().trim().required(),address:c.string().trim().allow("").required(),phone_number:c.string().allow("").trim().required()}),{error:n}=t.validate(e.body);if(n){const e=p.get(n,"details[0].message","An unknown error occurred");return d(r,e,400)}const i=e.body.username.trim(),o=e.body.address.trim(),u=e.body.phone_number.trim(),l=await s.findOneAndUpdate({username:i},{address:o,phone_number:u}).lean(),m={email:l.email,address:l.address,username:l.username,phone_number:l.phone_number};return a(r,m,"Profile updated successfully")}catch(e){return u(r,"Error occurred in profile update",e)}}}},868:(e,r,t)=>{const s=t(291),n=t(74),i=t(652),o=t(37),{successResponse:a,catchResponse:u,errorResponse:d}=t(640);e.exports={AllRestaurentFinder:async(e,r)=>{try{const e=await s.find();return a(r,e,"All restaurant found successfully")}catch(e){return u(r,"Error occured to get all restaurant",e)}},RestaurantByIdFinder:async(e,r)=>{try{const{id:t}=e.params;if(!o.isValidObjectId(t))return d(r,"Invalid restaurant page",400);const i=await s.findById(t),u=await n.find({restaurentId:i._id});return a(r,{restaurant:i,products:u||[]},"Restaurant data found successfully")}catch(e){return u(r,"Error occured in get restaurant data",e)}},AddOrder:async(e,r)=>{try{const{orderItems:t,shippingAddress:s,price:n,shippingPrice:a,totalPrice:u}=e.body,d=new i({userId:new o.Types.ObjectId(e.user._id),orderItems:t,shippingAddress:s,price:n,shippingPrice:a,totalPrice:u});await d.save(),r.status(200).json({message:"Order added successfully"})}catch(e){console.log(e),r.status(500).json({error:e.message})}}}},239:(e,r,t)=>{const s=t(571);e.exports={userAuthenticate:async(e,r,t)=>{const n=e.headers.authorization;if(!n)return r.status(404).json({error:"Invalid token"});{const i=await s.findOne({token:n});if(!i)return r.status(404).json({error:"Invalid token"});e.user=i,t()}}}},652:(e,r,t)=>{const s=t(37),n=new s.Schema({userId:{type:s.Schema.Types.ObjectId,ref:"User",required:!0},orderItems:[{name:{type:String,required:!0},quantity:{type:Number,required:!0},price:{type:Number,required:!0},productId:{type:s.Schema.Types.ObjectId,ref:"RestaurantProduct",required:!0}}],shippingAddress:{type:String,required:!0},price:{type:Number,required:!0,default:0},shippingPrice:{type:Number,required:!0,default:0},totalPrice:{type:Number,required:!0,default:0},isDelivered:{type:Boolean,required:!0,default:!1},deliveredAt:{type:Date}},{timestamps:!0});s.pluralize(null),e.exports=s.model("Order",n)},74:(e,r,t)=>{const s=t(37),n=new s.Schema({restaurentId:{type:s.Schema.Types.ObjectId,ref:"Restaurent",required:!0},name:{type:String,required:!0,trim:!0},price:{type:Number,required:!0},image:{type:String,required:!0},category:{type:String,required:!0},description:{type:String,required:!0}},{timestamps:!0});s.pluralize(null),e.exports=s.model("RestaurentProduct",n)},291:(e,r,t)=>{const s=t(37),n=new s.Schema({name:{type:String,required:!0,trim:!0},address:{type:String,required:!0,trim:!0},image:{type:String,required:!0,trim:!0},famous:{type:String,required:!0,trim:!0},rating:{type:Number,default:0,validate:{validator:function(e){return e>=0&&e<=5},message:e=>`${e.value} is not a valid rating!`}},phone_number:{type:String,validate:{validator:function(e){return!e||/^[1-9][0-9]{9}$/.test(e)},message:e=>`${e.value} is not a valid phone number!`},required:!0}},{timestamps:!0});s.pluralize(null),e.exports=s.model("Restaurent",n)},571:(e,r,t)=>{const s=t(37),n=new s.Schema({email:{unique:!0,type:String,required:!0,trim:!0},username:{unique:!0,type:String,required:!0,trim:!0},password:{type:String,required:!0},address:String,phone_number:{type:String,validate:{validator:function(e){return!e||/^[1-9][0-9]{9}$/.test(e)},message:e=>`${e.value} is not a valid phone number!`}},is_verified:{type:Boolean,required:!0},token:{type:String,required:!0}},{timestamps:!0});s.pluralize(null),n.index({email:1,username:1},{unique:!0}),e.exports=s.model("Users",n)},753:(e,r,t)=>{const{Register:s,Login:n,UserDataProvider:i,userProfileInfo:o,userUpdateProfile:a}=t(930),{userAuthenticate:u}=t(239),d=t(252).Router(),c=t(268).urlencoded({extended:!1});d.post("/register",c,s),d.post("/login",c,n),d.post("/user",c,i),d.get("/profile",u,o),d.post("/update-profile",c,u,a),e.exports=d},837:(e,r,t)=>{const{AllRestaurentFinder:s,RestaurantByIdFinder:n,AddOrder:i}=t(868),o=t(252).Router(),a=t(268).urlencoded({extended:!1}),{userAuthenticate:u}=t(239);o.get("/restaurent/all",s),o.get("/restaurent/:id",n),o.post("/restaurent/add-order",a,u,i),e.exports=o},640:(e,r,t)=>{const s=t(436);e.exports={successResponse:(e,r,t)=>e.json({success:1,data:r,message:t}),errorResponse:(e,r,t)=>(s.captureMessage(r),e.json({success:0,message:r,status:t})),catchResponse:(e,r,t)=>(s.captureException(t,r),console.log(t),e.status(500).json({success:0,message:r,error:t,status:500}))}},436:e=>{"use strict";e.exports=require("@sentry/node")},486:e=>{"use strict";e.exports=require("bcrypt")},268:e=>{"use strict";e.exports=require("body-parser")},898:e=>{"use strict";e.exports=require("cookie-parser")},577:e=>{"use strict";e.exports=require("cors")},818:e=>{"use strict";e.exports=require("dotenv")},252:e=>{"use strict";e.exports=require("express")},446:e=>{"use strict";e.exports=require("joi")},829:e=>{"use strict";e.exports=require("jsonwebtoken")},825:e=>{"use strict";e.exports=require("lodash")},37:e=>{"use strict";e.exports=require("mongoose")},928:e=>{"use strict";e.exports=require("path")},330:e=>{"use strict";e.exports=JSON.parse('{"name":"backend","version":"1.0.1","description":"","main":"server.js","scripts":{"test":"cross-env NODE_ENV=test jest --testTimeout=5000","start":"nodemon server.js","build:dev":"webpack --config webpack.config.js --mode development","build:prod":"webpack --config webpack.config.js --mode production","dev":"node ./dist/main.js"},"keywords":[],"author":"","license":"ISC","dependencies":{"@sentry/node":"^8.9.2","bcrypt":"^5.1.1","body-parser":"^1.20.2","cookie-parser":"^1.4.6","cors":"^2.8.5","cross-env":"^7.0.3","dotenv":"^16.3.1","express":"^4.19.2","jest":"^29.7.0","joi":"^17.13.3","jsonwebtoken":"^9.0.2","lodash":"^4.17.21","mongoose":"^8.0.0","nodemon":"^3.1.0","supertest":"^6.3.4"},"devDependencies":{"@babel/core":"^7.23.9","babel-loader":"^9.1.3","webpack":"^5.90.3","webpack-cli":"^5.1.4","webpack-node-externals":"^3.0.0"}}')}},r={};function t(s){var n=r[s];if(void 0!==n)return n.exports;var i=r[s]={exports:{}};return e[s](i,i.exports,t),i.exports}(()=>{t(317);const e=t(252),r=e(),s=t(577),n=(t(818).config(),process.env.PORT||80),i=t(412),o=t(753),a=t(898),u=t(837),d=t(928),c=process.env.ENVIRONMENT,p=("production"===c&&process.env.FRONTEND_BASE_URL,t(436));t(330),i(),r.use(a({})),r.use(s()),r.use("/images/restaurant",e.static(d.join(__dirname,"production"===c?"../src/Images/restaurant":"./src/Images/restaurant"))),r.use("/images/product",e.static(d.join(__dirname,"production"===c?"../src/Images/product":"./src/Images/product"))),r.use(e.urlencoded({extended:!0})),r.use(e.json()),r.use("/api/auth",o),r.use("/api",u),p.setupExpressErrorHandler(r),r.listen(n,(()=>{console.log(`Server is running on port ${n}`)}))})()})();